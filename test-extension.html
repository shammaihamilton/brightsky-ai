<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extension Test Page</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #f0f0f0;
            cursor: pointer;
        }
        button:hover {
            background: #e0e0e0;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>Extension Test Page</h1>
    <p>This page helps test the floating widget extension functionality.</p>

    <div class="test-section">
        <h2>Extension Context Status</h2>
        <div id="context-status" class="status info">Checking...</div>
        <button onclick="checkExtensionContext()">Check Extension Context</button>
        <button onclick="clearNotifications()">Clear Notifications</button>
    </div>

    <div class="test-section">
        <h2>Widget Status</h2>
        <div id="widget-status" class="status info">Checking...</div>
        <button onclick="checkWidget()">Check Widget</button>
        <button onclick="showWidget()">Show Widget</button>
        <button onclick="hideWidget()">Hide Widget</button>
    </div>

    <div class="test-section">
        <h2>Console Log</h2>
        <div id="console-log" style="background: #f5f5f5; padding: 10px; height: 200px; overflow-y: scroll; font-family: monospace; font-size: 12px;"></div>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        function addToLog(type, ...args) {
            const logDiv = document.getElementById('console-log');
            if (logDiv) {
                const timestamp = new Date().toLocaleTimeString();
                const message = args.map(arg => 
                    typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                ).join(' ');
                
                logDiv.innerHTML += `<div style="color: ${type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black'};">[${timestamp}] ${type.toUpperCase()}: ${message}</div>`;
                logDiv.scrollTop = logDiv.scrollHeight;
            }
        }
        
        console.log = (...args) => {
            originalLog(...args);
            addToLog('log', ...args);
        };
        
        console.warn = (...args) => {
            originalWarn(...args);
            addToLog('warn', ...args);
        };
        
        console.error = (...args) => {
            originalError(...args);
            addToLog('error', ...args);
        };

        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.className = `status ${type}`;
            }
        }

        function checkExtensionContext() {
            try {
                if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
                    updateStatus('context-status', 'Extension context is VALID ✓', 'success');
                    console.log('Extension context check: VALID');
                } else {
                    updateStatus('context-status', 'Extension context is INVALID ✗', 'error');
                    console.log('Extension context check: INVALID');
                }
            } catch (error) {
                updateStatus('context-status', `Extension context ERROR: ${error.message}`, 'error');
                console.error('Extension context check error:', error);
            }
        }

        function checkWidget() {
            const widget = document.getElementById('floating-widget-root');
            if (widget) {
                const isVisible = widget.style.display !== 'none';
                updateStatus('widget-status', `Widget found (${isVisible ? 'visible' : 'hidden'}) ✓`, 'success');
                console.log('Widget check: Found and', isVisible ? 'visible' : 'hidden');
            } else {
                updateStatus('widget-status', 'Widget NOT found ✗', 'error');
                console.log('Widget check: NOT found');
            }
        }

        function showWidget() {
            const widget = document.getElementById('floating-widget-root');
            if (widget) {
                widget.style.display = '';
                console.log('Widget manually shown');
                checkWidget();
            } else {
                console.log('Widget not found, cannot show');
            }
        }

        function hideWidget() {
            const widget = document.getElementById('floating-widget-root');
            if (widget) {
                widget.style.display = 'none';
                console.log('Widget manually hidden');
                checkWidget();
            } else {
                console.log('Widget not found, cannot hide');
            }
        }

        function clearNotifications() {
            const notification = document.getElementById('extension-reload-notification');
            if (notification) {
                notification.remove();
                console.log('Notification cleared');
            } else {
                console.log('No notification found');
            }
            
            // Reset global notification state
            if (window.__EXTENSION_NOTIFICATION_SHOWN__) {
                window.__EXTENSION_NOTIFICATION_SHOWN__ = false;
                console.log('Global notification state reset');
            }
        }

        function clearLog() {
            document.getElementById('console-log').innerHTML = '';
        }

        // Initial checks
        setTimeout(() => {
            checkExtensionContext();
            checkWidget();
        }, 1000);

        // Periodic checks
        setInterval(() => {
            checkExtensionContext();
            checkWidget();
        }, 5000);

        console.log('Test page loaded and ready');
    </script>
</body>
</html>
